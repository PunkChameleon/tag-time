<!DOCTYPE html>
<html>
<head>

<!-- <script type="text/javascript" src="TagView.js"></script> -->

<script type="text/javascript">

var TagView = function(document) {
	alert("here");
	var tagElem = document.createElement("input");

	tagElem.className = "tag-w";
	tagElem.value = "A tag..";

	var writeTagOnBlur = function(el) {
	// alert("here1");

		if (el.validTag()) {
			var tag = document.createElement("span");
			tag.className = el.className.substring(0, el.className.length-2) + "-r";
			tag.innerHTML = el.value;
			el.parentNode.replaceChild(tag, el);
		} else {
			el.parentNode.removeChild(el);
		}
	}
	
	tagElem.onblur = function() {
		writeTagOnBlur(this);
	}

	tagElem.validTag = function() {
		return this.value.indexOf("A tag..") === -1;

	return tagElem;
}

</script>

<script type="text/javascript">

// window.onblur = function() { 
// 	alert(this.className);
// }



document.onclick = function(evt) {
	var evt = window.event || evt;
	if (!evt.target) {
		evt.target = evt.srcElement;
	}
	var el = evt.target;
	// alert("here");
	if (el.className === "dt-r" || el.className === "tag-r") {
		var tagIn = document.createElement("input");
		tagIn.setAttribute("class", el.className.substring(0, el.className.length-2) + "-w");

		tagIn.onblur = function() { 
			writeTagOnBlur(this)
		};

		tagIn.validTag = function() {
				return this.value.indexOf("A tag..") === -1;
		}
		tagIn.value = el.innerHTML;
		// alert(tag.innerHTML);
		el.parentNode.replaceChild(tagIn, el);
		tagIn.focus();
	} 
	
	if (el.className === "time") {
		// alert("here");
		if (el.children.length === 0) {
			// el.innerHTML = "";
			// var tagIn = document.createElement("input");
			// tagIn.className = "dt-w";
			// tagIn.value = "How much time?";

			// tagIn.onblur = function() {
			// 	writeDtOnBlur(this);
			// }

			// tagIn.validTime = function() {
			// 	var r = /^[0-9]?[0-9]:[0-9][0-9]$/;
			// 	return r.test(this.value);
			// }
			alert ("new time")
			var tagIn = new TagView(document);
			alert(tagIn);

			el.appendChild(tagIn);
			tagIn.focus();
		} else {
			var tagIn = document.createElement("input");
			tagIn.className = "tag-w";
			tagIn.value = "A tag..";

			tagIn.onblur = function() {
				writeTagOnBlur(this);
			}
			tagIn.validTag = function() {
				return this.value.indexOf("A tag..") === -1;

			el.appendChild(tagIn);
			tagIn.focus();
			}
		}
	}
}

var editTagOnFocus = function() {
	alert("here");
}

// var writeTagOnBlur = function(el) {
// 	alert("here1");

// 	if (el.validTag()) {
// 		var tag = document.createElement("span");
// 		tag.className = el.className.substring(0, el.className.length-2) + "-r";
// 		tag.innerHTML = el.value;
// 		el.parentNode.replaceChild(tag, el);
// 	} else {
// 		el.parentNode.removeChild(el);
// 	}
// }

var writeDtOnBlur = function(el) {
	if (el.validTime()) {
		var timeTag = document.createElement("span");
		timeTag.className = "dt-r";
		timeTag.innerHTML = el.value;

		var emptyRow = el.parentNode.parentNode.parentNode.insertRow(-1);
		var emptyTime = emptyRow.insertCell(-1);
		emptyTime.className = "time";
		emptyTime.id = "tm_";
		emptyTime.innerHTML = "Click to tag new time ...";

		el.parentNode.replaceChild(timeTag, el);

	} else if (el.value === "How much time?") {
		if (el.className !== "removing") {
				el.className = "removing";
				var parent = el.parentNode;
				parent.removeChild(el);
				parent.innerHTML = "Click to tag new time ...";

			}

	} else {
		if (el.className !== "removing") {
			el.className = "removing";
			alert("Please enter time in the format hh:mm.")
			var parent = el.parentNode;
			parent.removeChild(el);
			parent.innerHTML = "Click to tag new time ...";

		}
	}
}

</script>

<style type="text/css">

.time-list {
	width: 750px;
	border-top: 2px solid;
}

.time {
	height: 50px;
	/*border-top: 2px solid;*/
	border-bottom: 2px solid;
	vertical-align: middle;
	margin: 0px 0px 0px 0px;
}

.dt-r,
.tag-r {
	padding: 5px;
	/*width: 20px;*/
	border-width: 2px;
	border-style: solid;
	border-collapse: collapse;
}

.dt-r {
	margin-right: 15px;
}

.tag-r {
	margin: 5px;
}

.dt-w,
.tag-w {
	padding: 5px;
	/*width: 20px;*/
	border-width: 2px;
	border-style: solid;
	border-collapse: collapse;
}

.dt-w {
	margin-right: 15px;
}

.tag-w {
	margin: 5px;
}


</style>


</head>

<body>
	<h1> Welcome to TagTime! </h1>

	<P> Pick the date and then add time with tags. </p>

<!--	<form>
		Date: <input type="date"> </input>
		<br/>
		Time: <input type="number"> </input>
		<br/>
		Tags: <textarea></textarea>
		<br/>
		<input type="submit" value="TagTime!"> </input>
	</form>
-->
	<table class='time-list'>
		<tr>
			<td class='time' id='tm1'>
			<!-- <div class='time' id='tm1'> -->
			<!--		<div class='dt' value='2.35'> 2hr 35min </div> 
					<div class='tag'> BNYM </div>
					<div class='tag'> Support </div>
					<div class='tag'> Billable </div> -->
					<span class='dt-r' value='2.35' onfocus='editTagOnFocus()'> 2hr 35min </span>
					<span class='tag-r'>BNYM</span>
					<span class='tag-r'>Support</span>
					<span class='tag-r'>Non-Billable</span>
					<!-- <input type='text' value='test'></input> -->
			<!-- </div> -->
			</td>
		</tr>
		<tr>
			<td class='time' id='tm1'>
			<!-- <div class='time' id='tm2'>  -->
			<!--		<div class='dt' value='2.35'> 2hr 35min </div> 
					<div class='tag'> BNYM </div>
					<div class='tag'> Support </div>
					<div class='tag'> Billable </div> -->
					<span class='dt-r' value='4.00'> 4hr </span>
					<span class='tag-r'>Barclays</span>
					<span class='tag-r'>Analysis</span>
					<span class='tag-r'>Billable</span>
			</td>
			<!-- </div> -->
		</tr>
		<tr><td class='time' id='tm_'>Click to tag new time ...</td></tr>
	</table>


	<div> </div>


</body>


</html>